"use strict";

angular.module("f3UC").controller("ExecuteCashRefundScriptController", ExecuteCashRefundScriptController);
angular.module("f3UC").controller("ExecuteItemSyncScriptController", ExecuteItemSyncScriptController);
angular.module("f3UC").controller("ExecuteSOSyncScriptController", ExecuteSOSyncScriptController);

angular.module("f3UC").controller("SearchCreditMemoController", SearchCreditMemoController);
angular.module("f3UC").controller("SearchCustomersController", SearchCustomersController);
angular.module("f3UC").controller("SearchOrdersController", SearchOrdersController);


angular.module("f3UC").controller("ViewCashRefundLogsController", ViewCashRefundLogsController);
angular.module("f3UC").controller("ViewFulfilmentSyncLogsController", ViewFulfilmentSyncLogsController);
angular.module("f3UC").controller("ViewSOSyncLogsController", ViewSOSyncLogsController);





function SearchCustomersController(f3StoreId) {

    console.log('SearchCustomersController');
    console.log('$location.path(): ', f3StoreId);
    this.storeId = f3StoreId;

}

function SearchCreditMemoController(f3StoreId){
    console.log('SearchCreditMemoController');
}

function SearchOrdersController(f3StoreId) {
    console.log('SearchMagentoOrdersController');
}




// TODO : need to implement inheritance to prevent duplicate code.
// TODO : we should also consider moving server calls into separate angular services

function ExecuteCashRefundScriptController(f3StoreId){
    console.log('ExecuteCashRefundScriptController');

    var viewModel = this;

    this.execute = function () {
        viewModel.showLoadingIcon = true;

        var apiUrl = location.href.replace(location.hash, '') + '&method=executeCashRefundSyncScript';
        $http.get(apiUrl)
            .success(function(response) {
                viewModel.successMessage = response.success;
                viewModel.errorMessage = response.error;
                viewModel.showLoadingIcon = false;
            });
    };
}
function ExecuteItemSyncScriptController(f3StoreId){
    console.log('ExecuteItemSyncScriptController');
    var viewModel = this;

    this.execute = function () {
        viewModel.showLoadingIcon = true;

        var apiUrl = location.href.replace(location.hash, '') + '&method=executeItemSyncScript';
        $http.get(apiUrl)
            .success(function(response) {
                viewModel.successMessage = response.success;
                viewModel.errorMessage = response.error;
                viewModel.showLoadingIcon = false;
            });
    };
}

function ExecuteSOSyncScriptController(f3StoreId, $http) {
    console.log('ExecuteSOSyncScriptController');

    var viewModel = this;

    this.execute = function () {
        viewModel.showLoadingIcon = true;

        var apiUrl = location.href.replace(location.hash, '') + '&method=executeSOSyncScript';
        $http.get(apiUrl)
            .success(function(response) {
                viewModel.successMessage = response.success;
                viewModel.errorMessage = response.error;
                viewModel.showLoadingIcon = false;
            });
    };
}






function ViewCashRefundLogsController(f3StoreId) {
    console.log('ViewCashRefundLogsController');
}
function ViewFulfilmentSyncLogsController(f3StoreId) {
    console.log('ViewFulfilmentSyncLogsController');
}


//ViewSOSyncLogsController.$inject = ['f3StoreId','$http'];
function ViewSOSyncLogsController(f3StoreId, $http) {
    console.log('ViewSOSyncLogsController');


    initGrid();

    function initGrid() {

        var $grid = jQuery("#jqGrid");

        jQuery.jgrid.defaults.width = jQuery('.page-content').outerWidth();

        $grid.jqGrid({
            autowidth: 'true',
            forceFit: true,
            styleUI: 'Bootstrap',
            datatype: function (options) {
                console.log('datatype();');
                //self.fetchGridData(options);

                var apiUrl = location.href.replace(location.hash, '') + '&method=getExecutionLogs';
                $http.get(apiUrl)
                    .success(function(response) {

                        if(!!response && response.length) {
                            $grid[0].addJSONData(response);
                        }
                        else {
                            $grid.clearGridData();
                        }

                    });
                //
                //
                //var data = [{
                //    guid: '4545454',
                //    type: 'DEBUG',
                //    date: '25/08/2015',
                //    title: 'Printed',
                //    detail: ''
                //}];
                //$grid[0].addJSONData(data)

            },
            idPrefix: 'row_',
            shrinkToFit: false,
            loadui: 'block',
            hoverrows: false,
            pgbuttons: false,
            pgtext: null,
            beforeSelectRow: function (rowid, e) {
                return false;
            },
            onSelectRow: function () {
                return false;
            },
            onRightClickRow: function () {
                $grid.jqGrid('resetSelection');
            },
            gridComplete: function () {
                //self.onGridCompleteInner();
            },
            colModel: [
                {sortable: false, hidden: true, label: '', name: 'guid', key: true},
                {sortable: false, label: 'Date', name: 'date', width: 100},
                {sortable: false, label: 'Title', name: 'title', width: 125},
                {sortable: false, label: 'Detail', name: 'detail', width: 125}
            ],
            viewrecords: false, // show records label in footer
            height: 'auto',
            rowNum: 1000,
            pager: "#jqGridPager"
        });

    }

}






function AlertsController(e) {
    e.labels = ['2006', '2007', '2008', '2009', '2010', '2011', '2012'],

    e.series = ['Series A'],

    e.data = [
        [65, 59, 80, 81, 56, 55, 40]
    ]
}

angular.module("f3UC").controller("AlertsController", ["$scope", AlertsController]);




function MasterController(t, e, h) {
    var o = 992;

    t.salesOrderCount = 0,
    t.customerCount = 0,
    t.itemCount = 0,

    t.failedSalesOrders = [],

    t.getWidth = function () {
        return window.innerWidth
    },

    t.$watch(t.getWidth, function (g, n) {
        t.toggle = g >= o ? angular.isDefined(e.get("toggle")) ? e.get("toggle") ? !0 : !1 : !0 : !1
    }),


    t.toggleSidebar = function () {
        t.toggle = !t.toggle, e.put("toggle", t.toggle)
    },

    window.onresize = function () {
        t.$apply()
    },

    t.getCustomersCount = function() {
        console.log('get customers called');
        return 888;
    },

    t.getSalesOrderCount = function() {
        //console.log('get getSalesOrderCount called');
        //
        //var apiUrl = location.href.replace(location.hash, '') + '&method=getSalesOrderCount';
        //$http.get(apiUrl)
        //    .success(function(response) {
        //        t.salesOrderCount = response[0].internalid;
        //    });

    },

    t.getItemsCount = function() {
        console.log('get getItemsCount called');
        return 888;
    };

    var apiUrl = location.href.replace(location.hash, '') + '&method=getSalesOrderCount';
    h.get(apiUrl)
        .success(function(response) {
            t.salesOrderCount = response[0].internalid;
        });

    apiUrl = location.href.replace(location.hash, '') + '&method=getCustomersCount';
    h.get(apiUrl)
        .success(function(response) {
            t.customerCount = response[0].internalid;
        });

    apiUrl = location.href.replace(location.hash, '') + '&method=getItemsCount';
    h.get(apiUrl)
        .success(function(response) {
            t.itemCount = response[0].internalid;
        });

    apiUrl = location.href.replace(location.hash, '') + '&method=getFailedSalesOrders';
    h.get(apiUrl)
        .success(function(response) {
            t.failedSalesOrders = response;
        });
}

angular.module("f3UC").controller("MasterController", ["$scope", "$cookieStore", "$http", MasterController]);

function rdLoading() {
    var d = {
        restrict: "AE",
        template: '<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'
    };
    return d
}
angular.module("f3UC").directive("rdLoading", rdLoading);

function rdWidgetBody() {
    var d = {
        requires: "^rdWidget",
        scope: {
            loading: "@?",
            classes: "@?"
        },
        transclude: !0,
        template: '<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',
        restrict: "E"
    };
    return d
}
angular.module("f3UC").directive("rdWidgetBody", rdWidgetBody);

function rdWidgetFooter() {
    var e = {
        requires: "^rdWidget",
        transclude: !0,
        template: '<div class="widget-footer" ng-transclude></div>',
        restrict: "E"
    };
    return e
}
angular.module("f3UC").directive("rdWidgetFooter", rdWidgetFooter);

function rdWidgetTitle() {
    var i = {
        requires: "^rdWidget",
        scope: {
            title: "@",
            icon: "@"
        },
        transclude: !0,
        template: '<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',
        restrict: "E"
    };
    return i
}
angular.module("f3UC").directive("rdWidgetHeader", rdWidgetTitle);

function rdWidget() {
    var d = {
        transclude: !0,
        template: '<div class="widget" ng-transclude></div>',
        restrict: "EA"
    };
    return d
}
angular.module("f3UC").directive("rdWidget", rdWidget);